# Техническое задание: Архитектура x-ui

Этот документ описывает утвержденную архитектуру для развертывания сервиса x-ui.

## Общая схема

Система состоит из двух основных компонентов:
1.  **Прокси-сервер (VDS1)**: Виртуальный сервер, выполняющий роль прокси и терминации SSL.
2.  **Сервер приложения (Hugging Face)**: Docker-контейнер, в котором работает само приложение x-ui.

## Компоненты и их взаимодействие

### 1. Прокси-сервер (vds1.iri1968.dpdns.org)

Этот сервер не содержит логики самого приложения. Его задачи:

*   **Chisel-сервер**:
    *   **Назначение**: Принимает туннельные соединения от сервера приложения.
    *   **Порт**: `8080` (внутренний).
    *   **Аутентификация**: `cloud:2025`

*   **Nginx**:
    *   **Назначение**: Принимает HTTPS трафик от конечных пользователей (клиентов и администратора) и от chisel-клиента, терминирует SSL и проксирует запросы.
    *   **Порт**: `80` (редирект на 443) и `443` (HTTPS/WSS).
    *   **Проксирование**:
        *   `location /`: `proxy_pass http://127.0.0.1:2023;` (для x-ui панели)
        *   `location /chisel`: `proxy_pass http://127.0.0.1:8080;` (для chisel-туннеля)
    *   **SSL**: Используются сертификаты от Let's Encrypt для домена `vds1.iri1968.dpdns.org`. Настроено автоматическое обновление.

### 2. Сервер приложения (Hugging Face)

*   **Среда выполнения**: Docker-контейнер.
*   **Логика**: Вся бизнес-логика приложения `x-ui` выполняется исключительно внутри этого контейнера.
*   **Порт x-ui**: `2023`
*   **Chisel-клиент**:
    *   **Назначение**: Устанавливает постоянный обратный туннель к Chisel-серверу на VDS1.
    *   **Команда**: `/usr/local/bin/chisel client -v --auth "cloud:2025" wss://vds1.iri1968.dpdns.org:443/chisel R:2023:127.0.0.1:2023`

## Потоки данных

1.  **Пользовательский трафик**:
    `Клиент/Админ -> https://vds1.iri1968.dpdns.org (Nginx, порт 443) -> Chisel-туннель (локальный порт 2023 на vds1) -> Приложение x-ui в Docker-контейнере (порт 2023)`

2.  **Туннельный трафик**:
    `Docker-контейнер (Chisel-клиент) -> wss://vds1.iri1968.dpdns.org:443/chisel (Nginx, порт 443) -> Chisel-сервер (порт 8080)`
