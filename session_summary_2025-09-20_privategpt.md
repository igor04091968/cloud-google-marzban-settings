# Сводка сессии: Отладка и запуск privateGPT

**Дата:** 20.09.2025

## Цель
Успешно запустить локальную версию `privateGPT` с помощью Docker, выполнить загрузку (ингестию) документов и убедиться, что веб-сервер доступен на порту `8001`.

## Исходное состояние
- Приложение `privateGPT` не запускалось корректно.
- Первоначальная диагностика указывала на конфликт портов.

## Ключевые этапы отладки и принятые решения

Процесс отладки был нелинейным и выявил несколько скрытых проблем:

1.  **Проблемы со скриптом ингестии (`ingest`):**
    *   **Ошибка:** `python: command not found`.
    *   **Решение:** Обнаружено, что в контейнере нужно использовать полный путь к Python. Команда исправлена на `.venv/bin/python3`.
    *   **Ошибка:** Скрипт `ingest.py` не найден.
    *   **Решение:** После анализа содержимого контейнера выяснилось, что скрипт называется `ingest_folder.py`.
    *   **Ошибка:** `AlreadyLocked: [Errno 11] Resource temporarily unavailable`. База данных Qdrant была заблокирована.
    *   **Решение:** Найден и удален старый файл блокировки `.lock` в директории Qdrant.
    *   **Ошибка:** `ValueError: could not broadcast input array from shape (384,) into shape (768,)`. Несоответствие размерности векторов.
    *   **Решение:** Полностью удалена директория с базой данных Qdrant (`local_data/private_gpt/qdrant`), чтобы она была создана заново с правильными параметрами.
    *   **Ошибка:** `ValueError: Local ingestion is disabled`.
    *   **Решение:** В `settings.yaml` изменен параметр `enabled` на `true` в секции `local_ingestion`.

2.  **Проблема с портом веб-сервера:**
    *   **Симптом:** После решения проблем с ингестией, веб-сервер запускался, но слушал на случайном порту, игнорируя настройки.
    *   **Диагностика:**
        *   Проверка переменных окружения (`printenv PORT`) показала корректное значение `8001`.
        *   Проверка `settings.yaml` подтвердила, что он должен использовать эту переменную.
        *   Попытка "сломать" `settings.yaml` показала, что файл читается, но это не решало проблему с портом.
        *   Анализ `docker inspect` выявил, что `command` в `docker-compose.yaml` некорректно взаимодействовал с `ENTRYPOINT` в образе.
    *   **Финальное решение:** Первопричина оказалась в том, что базовый Docker-образ содержал жестко заданную конфигурацию порта. Единственным надежным способом оказалось **изменить `Dockerfile.llamacpp-cpu`, установив `ENV PORT=8001`**, и **пересобрать Docker-образ** локально.

## Итоговое состояние
- **`privateGPT` успешно запущен и работает.**
- Процесс ингестии документов завершен успешно.
- Веб-сервер доступен по адресу `http://localhost:8001`.
- Все временные изменения в файлах конфигурации (`docker-compose.yaml`, `settings.yaml`) были отменены, так как исправление было внесено на уровне Docker-образа.
- Создан этот отчет для документирования процесса.
